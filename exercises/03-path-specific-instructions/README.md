# Exercise 3: Path-Specific Instructions

**Build a Developer Agent for the Implementation phase of the SDLC.**

In this exercise you create path-specific instruction files that give Copilot different coding conventions for different parts of your codebase. You then build a Developer Agent that reads the schema from Exercise 02 and generates a working implementation.

---

## Learning Objectives

- Create path-specific instruction files (`.instructions.md`) with YAML front matter.
- Use `applyTo` glob patterns to target specific directories.
- Understand how Copilot combines repo-wide and path-specific instructions.
- Build a Developer Agent that follows directory-level conventions.

---

## Prerequisites

- [Exercise 01](../01-prompt-engineering/README.md) and [Exercise 02](../02-custom-instructions/README.md) are complete.
- The file `docs/schema.md` exists (generated by the Architect Agent in Exercise 02).
- The file `.github/copilot-instructions.md` exists with your project conventions.

---

## Understanding Path-Specific Instructions

Repository-wide instructions apply to every Copilot request. Path-specific instructions apply only when Copilot works with files that match a glob pattern.

When Copilot works on a matching file, it combines:

1. The repo-wide instructions from `.github/copilot-instructions.md`
2. All matching path-specific instructions from `.github/instructions/`

Both sets are active at the same time. This lets you define general project conventions once and add targeted rules for specific directories.

Path-specific instruction files:

- Live inside `.github/instructions/`
- Use the `.instructions.md` file name suffix
- Start with a YAML front matter block that contains an `applyTo` field

For the full reference, see [Adding repository custom instructions for GitHub Copilot](https://docs.github.com/en/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot).

---

## YAML Front Matter Syntax

Every path-specific instruction file starts with a YAML front matter block. The `applyTo` field contains a glob pattern that determines which files trigger the instructions.

```yaml
---
applyTo: "src/models/**"
---
```

The front matter block must:

- Start on the very first line of the file (no blank lines before `---`)
- Begin and end with three hyphens on their own line
- Contain an `applyTo` value as a quoted string

### Glob Pattern Examples

| Pattern | Matches |
|---------|---------|
| `"src/models/**"` | All files under `src/models/` and its subdirectories |
| `"src/**/*.js"` | All `.js` files anywhere under `src/` |
| `"**/*.test.js"` | All `.test.js` files in the entire repository |
| `"docs/**/*.md"` | All Markdown files under `docs/` |
| `"src/utils/*"` | Files directly inside `src/utils/` (not subdirectories) |

---

## Step 1: Create the Instructions Directory

1. Create the `.github/instructions/` directory if it does not already exist:

   ```bash
   mkdir -p .github/instructions
   ```

---

## Step 2: Create the Models Instruction File

This file tells Copilot how to write code for the `src/models/` directory.

1. Create `.github/instructions/models.instructions.md` with the following content:

   ```markdown
   ---
   applyTo: "src/models/**"
   ---

   # Model File Instructions

   - Export a single class per file.
   - Validate all constructor arguments. Throw a `TypeError` with a
     descriptive message for invalid inputs.
   - Include a `toJSON()` method that returns a plain object.
   - Generate unique IDs using `crypto.randomUUID()`.
   - Add JSDoc comments to the class and every public method.
   ```

2. Save the file.

---

## Step 3: Create the Services Instruction File

This file tells Copilot how to write code for the `src/services/` directory.

1. Create `.github/instructions/services.instructions.md` with the following content:

   ```markdown
   ---
   applyTo: "src/services/**"
   ---

   # Service File Instructions

   - Export functions, not classes.
   - Every function that modifies data must return the modified object.
   - Return copies of data, never direct references to internal state.
   - Throw descriptive errors for "not found" and "invalid input" cases.
   - Keep functions small. Each function handles one operation.
   ```

2. Save the file.

---

## Step 4: Create the Utils Instruction File

This file tells Copilot how to write code for the `src/utils/` directory.

1. Create `.github/instructions/utils.instructions.md` with the following content:

   ```markdown
   ---
   applyTo: "src/utils/**"
   ---

   # Utility File Instructions

   - Export pure functions only. No side effects.
   - Every function must validate its inputs and throw a `TypeError`
     for invalid arguments.
   - Include at least two usage examples in each JSDoc comment.
   ```

2. Save the file.

---

## Step 5: Verify the Instruction File Structure

Your `.github/instructions/` directory should now contain three files:

```
.github/instructions/
  models.instructions.md
  services.instructions.md
  utils.instructions.md
```

Each file targets a different subdirectory under `src/`. When Copilot generates code for a file in `src/models/`, only the models instructions activate. When it generates code for `src/services/`, only the services instructions activate.

---

## Step 6: Create the Developer Agent

The Developer Agent reads a schema document and generates implementation code. It follows the conventions in your repo-wide and path-specific instructions.

1. Create the agents directory if it does not exist:

   ```bash
   mkdir -p .github/agents
   ```

2. Create `.github/agents/developer.agent.md` with the following content:

   ```markdown
   ---
   name: developer
   description: Reads a schema document and generates implementation code following path-specific conventions
   ---

   You are a software developer. Given a data schema and file structure
   document, you generate working implementation code.

   ## Process

   1. Read the schema document the user provides.
   2. Create each file described in the schema's file structure.
   3. Follow the conventions in `.github/copilot-instructions.md`
      and any matching path-specific instruction files in
      `.github/instructions/`.
   4. After generating all files, run the entry point with Node.js
      to verify there are no syntax or runtime errors.
   5. Fix any errors and re-run until the code executes without issues.

   ## Rules

   - Use only built-in Node.js modules.
   - Place source files under `src/` following the structure in the schema.
   - Every file must use ES module syntax (`import`/`export`).
   - Add `console.log` calls in the entry point to demonstrate each feature.
   ```

3. Save the file.

---

## Step 7: Generate the Implementation

Use the Developer Agent to turn your schema into working code.

1. Open Copilot Chat in VS Code.

2. Select **developer** from the agent dropdown at the top of the Chat panel.

3. Enter the following prompt:

   ```
   Read #file:docs/schema.md and implement the Task Manager application.

   Create these files:
   1. src/models/task.js — Task class with validation
   2. src/services/taskService.js — CRUD operations for tasks
   3. src/utils/validators.js — input validation helpers
   4. src/index.js — entry point that demonstrates all features

   After creating all files, run src/index.js with Node.js and fix
   any errors.
   ```

4. Approve each file creation when prompted.

5. Watch the agent run the code and iterate on any errors it finds.

---

## Step 8: Run the Application

After the agent finishes, verify the output yourself.

1. Run the entry point:

   ```bash
   node src/index.js
   ```

2. You should see console output that demonstrates:

   - Creating tasks with validated inputs
   - Listing and filtering tasks
   - Updating task status
   - Deleting tasks
   - Error handling for invalid inputs

If the code fails, paste the error into Copilot Chat (with the developer agent selected) and ask it to fix the issue.

---

## Step 9: Verify Path-Specific Instructions Were Applied

Check that the generated code follows the conventions from each instruction file.

### Models (`src/models/task.js`)

- [ ] Exports a single `Task` class
- [ ] Validates constructor arguments and throws `TypeError` for invalid inputs
- [ ] Includes a `toJSON()` method
- [ ] Generates IDs with `crypto.randomUUID()`
- [ ] Has JSDoc comments on the class and public methods

### Services (`src/services/taskService.js`)

- [ ] Exports functions, not a class
- [ ] Functions that modify data return the modified object
- [ ] Returns copies of data, not references to internal state
- [ ] Throws descriptive errors for "not found" and "invalid input"

### Utils (`src/utils/validators.js`)

- [ ] Exports pure functions with no side effects
- [ ] Validates inputs and throws `TypeError` for invalid arguments
- [ ] JSDoc comments include usage examples

### General (all files)

- [ ] Uses ES module syntax (`import`/`export`)
- [ ] Uses only built-in Node.js modules
- [ ] Follows the code style from `.github/copilot-instructions.md`

If any checklist item fails, open the file and ask Copilot to fix it. The path-specific instructions for that directory activate automatically.

---

## Step 10: Confirm Instruction Layering

Verify that Copilot loads both repo-wide and path-specific instructions.

1. Open `src/models/task.js` in the editor.
2. Open Copilot Chat and ask:

   ```
   Add a method called clone() that returns a copy of this task with a new ID.
   ```

3. Click the **Used n references** link at the top of the response.
4. You should see both:

   - `.github/copilot-instructions.md` (repo-wide)
   - `.github/instructions/models.instructions.md` (path-specific)

5. Now open `src/services/taskService.js` and ask a similar question. The references should show `services.instructions.md` instead of `models.instructions.md`.

---

## Step 11: Commit and Push

```bash
git add .github/instructions/ .github/agents/ src/
git commit -m "Add path-specific instructions and Developer Agent with implementation"
git push
```

After you push, the workflow checks your work and posts the next step.

---

## Troubleshooting

**Path-specific instructions are not loaded:**

- Confirm the file is inside `.github/instructions/` (not inside `.github/` directly).
- Confirm the file name ends with `.instructions.md`.
- Confirm the YAML front matter starts on the first line of the file. No blank lines before `---`.
- Confirm the `applyTo` pattern matches the file you have open.

**The YAML front matter syntax is invalid:**

- The block must begin and end with `---` on its own line.
- The `applyTo` value must be a quoted string.
- Do not add extra fields to the front matter block.

**The developer agent fails to run the code:**

- Check for ES module issues. You may need to add `"type": "module"` to a `package.json`.
- Confirm all `import` paths include the `.js` extension (required by Node.js ES modules).
- Run `node src/index.js` manually and paste any errors into Copilot Chat.

**Generated code does not follow the conventions:**

- Open the source file in the editor so path-specific instructions activate.
- Ask Copilot to refactor the code. It picks up the matching instructions automatically.

---

## Review: How Instruction Layering Works

```
┌──────────────────────────────────────────────────────────┐
│  .github/copilot-instructions.md                         │
│  (Repo-wide: applies to ALL Copilot requests)            │
├──────────────────────────────────────────────────────────┤
│                                                          │
│  .github/instructions/models.instructions.md             │
│  applyTo: "src/models/**"                                │
│  → Active when editing files in src/models/              │
│                                                          │
│  .github/instructions/services.instructions.md           │
│  applyTo: "src/services/**"                              │
│  → Active when editing files in src/services/            │
│                                                          │
│  .github/instructions/utils.instructions.md              │
│  applyTo: "src/utils/**"                                 │
│  → Active when editing files in src/utils/               │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

When you edit `src/models/task.js`, Copilot loads:

1. `.github/copilot-instructions.md` (always active)
2. `.github/instructions/models.instructions.md` (matches `src/models/**`)

The services and utils instructions are not loaded because the file does not match their patterns.

---
