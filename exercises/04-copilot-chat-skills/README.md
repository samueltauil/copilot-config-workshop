# Exercise 4: Prompt Files

**SDLC Phase: Testing & Quality Assurance**

In this exercise you create prompt files that capture reusable testing workflows, then build a **Tester Agent** that generates and runs tests automatically. The Developer Agent from Exercise 03 generated your implementation code. Before you can trust it, you need tests.

## Workshop Roadmap

| Exercise | Copilot Concept | Agent | SDLC Phase |
|----------|----------------|-------|------------|
| 01 | Prompt engineering and interaction modes | Planner | Planning |
| 02 | Repository-wide custom instructions | Architect | Design |
| 03 | Path-specific instructions | Developer | Implementation |
| **04 (this one)** | Prompt files | Tester | Testing |
| 05 | Agent files and orchestration | Orchestrator | Full lifecycle |

Each exercise builds on the output of the previous one. The Developer Agent produced source files under `src/`. The Tester Agent reads those files and generates comprehensive tests.

---

## Learning Objectives

After completing this exercise you will be able to:

- Create prompt files (`.prompt.md`) with YAML front matter
- Invoke prompt files with the `/` command in Copilot Chat
- Use the `description`, `agent`, and `argument-hint` front matter fields
- Build a Tester Agent that generates, runs, and iterates on tests
- Run tests with the built-in Node.js test runner

---

## Prerequisites

- [Exercise 01](../01-prompt-engineering/README.md), [Exercise 02](../02-custom-instructions/README.md), and [Exercise 03](../03-path-specific-instructions/README.md) are complete.
- The `src/` directory contains implementation code (generated by the Developer Agent in Exercise 03).
- The file `.github/copilot-instructions.md` exists with your project conventions.
- Node.js 20 or later (pre-installed in the Codespace).

---

## Understanding Prompt Files

Prompt files let you save multi-step prompts as reusable files in your repository. You invoke them with the `/` command in Copilot Chat instead of typing the full prompt each time.

This is different from the other Copilot customization files you have used so far:

| File Type | Purpose | How It Activates |
|-----------|---------|-----------------|
| `copilot-instructions.md` | Repo-wide conventions (how to write code) | Automatic on every request |
| `.instructions.md` | Path-specific rules (how to write code in a directory) | Automatic when a matching file is open |
| `.prompt.md` | Reusable workflow (what task to perform) | Manual via `/` command |
| `.agent.md` | Specialized Copilot personality with tool restrictions | Manual via agent dropdown |

Instructions tell Copilot **how** to do things. Prompt files tell Copilot **what** to do.

Prompt files:

- Live inside `.github/prompts/`
- Use the `.prompt.md` file name suffix
- Start with a YAML front matter block followed by a Markdown prompt body
- Can reference workspace files using Markdown links for additional context

For the full reference, see [Creating prompt files](https://docs.github.com/en/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot#creating-prompt-files).

---

## YAML Front Matter Fields

Every prompt file starts with a YAML front matter block between `---` markers. Three fields control how the prompt appears and runs.

```yaml
---
description: Generate unit tests for a source module
agent: agent
argument-hint: Path to the source file to test (e.g. src/models/task.js)
---
```

| Field | Required | Purpose |
|-------|----------|---------|
| `description` | Yes | Short label shown in the `/` command list |
| `agent` | No | Which Copilot mode runs the prompt (use `agent` for Agent Mode) |
| `argument-hint` | No | Placeholder text shown in the argument input after selection |

The front matter block must:

- Start on the very first line of the file (no blank lines before `---`)
- Begin and end with three hyphens on their own line
- Contain the `description` value as a quoted string

When you set `agent: agent`, the prompt runs in Agent Mode. This gives Copilot the ability to create files, edit code, and run terminal commands autonomously.

The `argument-hint` field tells users what input the prompt expects. When a user selects the prompt, they see this hint as placeholder text.

---

## Testing Conventions

Before creating the prompt files, understand the testing conventions for this project:

- **Test runner:** Built-in Node.js test runner (`node --test`)
- **Assertions:** `node:assert` module (no external libraries)
- **File location:** Test files go in the `tests/` directory
- **File naming:** Use the pattern `<module>.test.js` (e.g., `task.test.js`)
- **Test names:** Descriptive names that explain the expected behavior
- **Coverage:** Normal inputs, edge cases, and error conditions

These conventions match the constraints from Exercise 01: Node.js only, no external dependencies.

---

## Step 1: Create the Prompts Directory

1. Create the `.github/prompts/` directory:

   ```bash
   mkdir -p .github/prompts
   ```

---

## Step 2: Create the Generate-Tests Prompt File

This prompt file generates a complete test file for any source module.

1. Create `.github/prompts/generate-tests.prompt.md` with the following content:

   ```markdown
   ---
   description: Generate unit tests for a source module
   agent: agent
   argument-hint: Path to the source file to test (e.g. src/models/task.js)
   ---

   # Generate Unit Tests

   Your goal is to generate unit tests for the module the user specifies.

   ## Steps

   1. Read the target source file.
   2. Identify all exported functions and classes.
   3. Generate tests that cover:
      - Normal inputs with expected outputs
      - Edge cases (empty strings, zero, negative numbers, null, undefined)
      - Error conditions (invalid types, missing required fields)
   4. Use the built-in Node.js `node:assert` module and Node.js test runner.
   5. Save the test file to `tests/` using the convention `<module>.test.js`.
   6. Run the tests with `node --test` and fix any failures.
   ```

2. Save the file.

### How this prompt file works

- The `description` appears when users type `/` in Copilot Chat.
- The `agent: agent` field runs the prompt in Agent Mode so Copilot can create files and run commands.
- The `argument-hint` tells users to provide a file path.
- The Markdown body defines the step-by-step workflow Copilot follows.

---

## Step 3: Create the Test-Edge-Cases Prompt File

This prompt file adds edge case coverage to an existing test file.

1. Create `.github/prompts/test-edge-cases.prompt.md` with the following content:

   ```markdown
   ---
   description: Add edge case tests for an existing test file
   agent: agent
   argument-hint: Path to the existing test file
   ---

   # Add Edge Case Tests

   Review the existing test file the user provides. Add tests for any
   edge cases not already covered.

   Focus on:
   - Boundary values (empty arrays, max integers, very long strings)
   - Type mismatches (passing a number where a string is expected)
   - Concurrent modifications (adding while iterating)
   - Missing optional fields
   - Duplicate entries

   Run all tests after adding the new cases and fix any failures.
   ```

2. Save the file.

---

## Step 4: Verify the Prompt File Structure

Your `.github/prompts/` directory should now contain two files:

```
.github/prompts/
  generate-tests.prompt.md
  test-edge-cases.prompt.md
```

### Test that the prompt files appear

1. Open Copilot Chat in VS Code.
2. Type `/` in the prompt box.
3. You should see **generate-tests** and **test-edge-cases** in the list.

If the prompts do not appear, reload the VS Code window: press `Ctrl+Shift+P` (or `Cmd+Shift+P` on macOS) and type **Reload Window**.

---

## Step 5: Create the Tester Agent

The Tester Agent combines both prompt workflows into a single specialized persona. It reads all source files, generates tests, runs them, and iterates until every test passes.

1. Create the agents directory if it does not exist:

   ```bash
   mkdir -p .github/agents
   ```

2. Create `.github/agents/tester.agent.md` with the following content:

   ```markdown
   ---
   name: tester
   description: Generates and runs tests for the Task Manager, iterating until all tests pass
   ---

   You are a quality assurance engineer. Your job is to test the
   Task Manager implementation thoroughly.

   ## Process

   1. Read all source files under `src/`.
   2. Generate a test file for each module under `tests/`.
   3. Use the built-in Node.js test runner (`node --test`) and
      `node:assert` for assertions.
   4. Run the full test suite after generation.
   5. If any tests fail, read the error output, fix the issue
      (in the test or in the source code), and re-run.
   6. Repeat until all tests pass.

   ## Rules

   - Never skip or delete a failing test. Fix the root cause.
   - Test both success paths and error paths.
   - Each test file must be runnable independently.
   - Use descriptive test names that explain the expected behavior.
   ```

3. Save the file.

### Prompt files vs. the Tester Agent

Prompt files and agents serve different purposes in this exercise:

| Aspect | Prompt File | Tester Agent |
|--------|-------------|--------------|
| Scope | One module at a time | All modules at once |
| Activation | Type `/` and select a prompt | Select from the agent dropdown |
| Use case | Quick, targeted test generation | Full test suite creation and iteration |

Use prompt files for focused tasks. Use the agent for comprehensive workflows.

---

## Step 6: Generate Tests with the Tester Agent

1. Open Copilot Chat in VS Code.

2. Select **tester** from the agent dropdown at the top of the Chat panel.

3. Enter the following prompt:

   ```text
   Read all source files in src/ and generate comprehensive tests
   in the tests/ directory. Cover the Task model, the task service,
   and the validator utilities. Run the tests and fix any failures.
   ```

4. Watch the agent generate test files, run them, and iterate on failures.

5. The agent follows the iterate-until-pass pattern:
   - Generate tests
   - Run `node --test tests/`
   - Read any failure output
   - Fix the failing test or the source code
   - Re-run until all tests pass

6. When the agent finishes, verify independently:

   ```bash
   node --test tests/
   ```

   You should see output listing each test with a pass or fail status.

---

## Step 7: Try the Prompt Files

After the agent generates the initial test suite, use the prompt files for targeted work.

### Use generate-tests on a specific module

1. Type `/` in Copilot Chat.
2. Select **generate-tests** from the list.
3. Provide the path `src/utils/validators.js` (or whichever module you want).
4. Compare the output to the tests the agent already wrote.

### Use test-edge-cases to expand coverage

1. Type `/` in Copilot Chat.
2. Select **test-edge-cases** from the list.
3. Provide the path to an existing test file, such as `tests/task.test.js`.
4. Review the new edge case tests the prompt adds.
5. Run the full suite to confirm everything still passes:

   ```bash
   node --test tests/
   ```

---

## Step 8: Commit and Push

```bash
git add .github/prompts/ .github/agents/ tests/
git commit -m "Add prompt files and Tester Agent with tests"
git push
```

After you push, the workflow checks your work and posts the next step.

---

## Verification Checklist

Before moving on, confirm each item:

- [ ] `.github/prompts/generate-tests.prompt.md` exists with valid YAML front matter
- [ ] `.github/prompts/test-edge-cases.prompt.md` exists with valid YAML front matter
- [ ] `.github/agents/tester.agent.md` exists with `name` and `description`
- [ ] The `tests/` directory contains `.test.js` files
- [ ] `node --test tests/` runs and all tests pass
- [ ] Tests cover normal inputs, edge cases, and error conditions
- [ ] Tests use `node:assert` (no external test libraries)

---

## The Iterate-Until-Pass Pattern

The Tester Agent uses a feedback loop that is central to agent-based testing:

```
┌─────────────────────┐
│  Read source files  │
└────────┬────────────┘
         │
         ▼
┌─────────────────────┐
│  Generate tests     │
└────────┬────────────┘
         │
         ▼
┌─────────────────────┐
│  Run tests          │◄──────────────┐
└────────┬────────────┘               │
         │                            │
    ┌────▼────┐                       │
    │ Pass?   │── No ──► Fix issue ───┘
    └────┬────┘
         │ Yes
         ▼
┌─────────────────────┐
│  Done               │
└─────────────────────┘
```

The key principle: never skip or delete a failing test. Always fix the root cause, whether it is in the test logic or the source code.

---

## Troubleshooting

**Prompt files do not appear in the `/` list:**

- Confirm the files are inside `.github/prompts/` (not `.github/` directly).
- Confirm each file name ends with `.prompt.md`.
- Confirm the YAML front matter starts on the first line. No blank lines before `---`.
- Reload the VS Code window after adding new prompt files.

**The `node --test` command is not found:**

- You need Node.js 18 or later. The Codespace uses Node.js 20.
- Run `node --version` to check your version.

**Tests fail because source code has issues:**

- Let the Tester Agent fix both the tests and the source code.
- Paste the error output into Copilot Chat while the tester agent is selected.

**The YAML front matter syntax is invalid:**

- The block must begin and end with `---` on its own line.
- The `description` value must be present.
- Do not add extra fields that are not supported.

**The agent generates tests with external libraries (jest, mocha):**

- Check that your `.github/copilot-instructions.md` specifies "no external dependencies."
- Add explicit instructions in the prompt: "Use only `node:assert` and the built-in Node.js test runner."

**Tests pass individually but fail when run together:**

- Ensure each test file is self-contained with no shared mutable state.
- Each `describe` or `test` block should set up its own data.

---

## Review: How Prompt Files Fit the Copilot Configuration Stack

```
┌──────────────────────────────────────────────────────────┐
│  .github/copilot-instructions.md                         │
│  (Repo-wide: applies to ALL requests)                    │
├──────────────────────────────────────────────────────────┤
│  .github/instructions/*.instructions.md                  │
│  (Path-specific: applies when matching files are open)   │
├──────────────────────────────────────────────────────────┤
│  .github/prompts/*.prompt.md                             │
│  (Prompt files: invoked manually with /)                 │
├──────────────────────────────────────────────────────────┤
│  .github/agents/*.agent.md                               │
│  (Custom agents: selected from agent dropdown)           │
└──────────────────────────────────────────────────────────┘
```

Instructions define conventions. Prompt files define workflows. Agents define personas. Each layer serves a different purpose, and they all work together.

---
